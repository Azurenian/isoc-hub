<!-- Sidebar Navigation -->
<script>
  // Track active animations for cleanup
  let currentAnimation = null;
  let isNavigating = false;
  let navigationDebounceTimer = null;

  /**
   * Shows the specified section and updates sidebar navigation state, with GSAP animations.
   * @param {string} sectionId - The ID of the section to show.
   * @returns {void}
   */
  function showSection(sectionId) {
    // Prevent rapid navigation clicks
    if (isNavigating) return;

    // Clear any pending navigation debounce
    if (navigationDebounceTimer) {
      clearTimeout(navigationDebounceTimer);
      navigationDebounceTimer = null;
    }

    isNavigating = true;

    var sections = document.querySelectorAll(".section");
    var target = document.getElementById(sectionId);
    var currentlyVisible = null;

    // Kill any in-progress animations
    if (currentAnimation) {
      currentAnimation.kill();
      currentAnimation = null;
    }

    // Reset all sections to ensure proper state
    sections.forEach(function (section) {
      if (section === target) return;

      // If a section is currently visible but not our target, mark it for transition
      if (section.style.display !== "none") {
        currentlyVisible = section;
      }

      // Reset any lingering animation properties
      gsap.set(section, {
        clearProps: "opacity,transform,y",
      });
    });

    // If the target is already visible, just update navigation state
    if (target && target.style.display !== "none") {
      updateNavigationState(sectionId);
      isNavigating = false;
      return;
    }

    // Animate out the currently visible section (if any)
    if (currentlyVisible) {
      // Animate out: fade and slide up, then hide
      currentAnimation = gsap.to(currentlyVisible, {
        duration: 0.35,
        opacity: 0,
        y: -30,
        pointerEvents: "none",
        onComplete: function () {
          currentlyVisible.style.display = "none";
          // Reset any animation properties
          gsap.set(currentlyVisible, {
            clearProps: "opacity,transform,y,pointerEvents",
          });

          // Animate in the target section
          if (target) {
            target.style.display = "block";
            target.style.opacity = 0;
            target.style.transform = "translateY(30px)";

            currentAnimation = gsap.to(target, {
              duration: 0.4,
              opacity: 1,
              y: 0,
              pointerEvents: "auto",
              onComplete: function () {
                gsap.set(target, {
                  clearProps: "opacity,transform,y",
                });
                currentAnimation = null;
                isNavigating = false;
              },
            });
          } else {
            currentAnimation = null;
            isNavigating = false;
          }
        },
      });
    } else if (target) {
      // No section currently visible, just animate in
      target.style.display = "block";
      target.style.opacity = 0;
      target.style.transform = "translateY(30px)";

      currentAnimation = gsap.to(target, {
        duration: 0.4,
        opacity: 1,
        y: 0,
        pointerEvents: "auto",
        onComplete: function () {
          gsap.set(target, {
            clearProps: "opacity,transform,y",
          });
          currentAnimation = null;
          isNavigating = false;
        },
      });
    }

    // Update the navigation state
    updateNavigationState(sectionId);

    // Add a brief debounce period to prevent rapid clicks
    navigationDebounceTimer = setTimeout(function () {
      if (isNavigating && !currentAnimation) {
        // Failsafe: if we're stuck in navigating state with no animation,
        // reset it after a short timeout
        isNavigating = false;
      }
    }, 10); // Reduced from 500ms to 100ms for faster responsiveness
  }

  /**
   * Updates the sidebar navigation state
   * @param {string} sectionId - The ID of the active section
   */
  function updateNavigationState(sectionId) {
    var navLinks = document.querySelectorAll(".sidebar .nav-link");
    navLinks.forEach(function (link) {
      link.classList.remove("active");
    });
    var activeLink = document.getElementById(sectionId + "-nav");
    if (activeLink) {
      activeLink.classList.add("active");
    }
  }

  // Initialize hub as active section on page load
  document.addEventListener("DOMContentLoaded", function () {
    // Set hub as the default active section
    const hubSection = document.getElementById("hub-section");
    if (hubSection) {
      hubSection.style.display = "block";
    }

    const hubLink = document.getElementById("hub-section-nav");
    if (hubLink) {
      hubLink.classList.add("active");
    }

    // Make sure all other sections are hidden on load
    document.querySelectorAll(".section").forEach(function (section) {
      if (section.id !== "hub-section") {
        section.style.display = "none";
      }
    });
  });
</script>

<div class="dark-mode-container d-flex align-items-center">
  <span class="me-2">Dark Mode</span>
  <label class="switch">
    <input id="dark-light-toggle" type="checkbox" />
    <span class="slider">
      <div class="star star_1"></div>
      <div class="star star_2"></div>
      <div class="star star_3"></div>
      <svg viewBox="0 0 16 16" class="cloud_1 cloud">
        <path
          transform="matrix(.77976 0 0 .78395-299.99-418.63)"
          fill="#fff"
          d="m391.84 540.91c-.421-.329-.949-.524-1.523-.524-1.351 0-2.451 1.084-2.485 2.435-1.395.526-2.388 1.88-2.388 3.466 0 1.874 1.385 3.423 3.182 3.667v.034h12.73v-.006c1.775-.104 3.182-1.584 3.182-3.395 0-1.747-1.309-3.186-2.994-3.379.007-.106.011-.214.011-.322 0-2.707-2.271-4.901-5.072-4.901-2.073 0-3.856 1.202-4.643 2.925"
        ></path>
      </svg>
    </span>
  </label>
</div>

<style>
  /* Theme Switch from UIverse.io */
  .switch {
    font-size: 17px;
    position: relative;
    display: inline-block;
    width: 4em;
    height: 2.2em;
    border-radius: 30px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }

  /* Hide default HTML checkbox */
  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  /* The slider */
  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #2a2a2a;
    transition: 0.4s;
    border-radius: 30px;
    overflow: hidden;
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 1.2em;
    width: 1.2em;
    border-radius: 20px;
    left: 0.5em;
    bottom: 0.5em;
    transition: 0.4s;
    transition-timing-function: cubic-bezier(0.81, -0.04, 0.38, 1.5);
    box-shadow: inset 8px -4px 0px 0px #fff;
  }

  .switch input:checked + .slider {
    background-color: #00a6ff;
  }

  .switch input:checked + .slider:before {
    transform: translateX(1.8em);
    box-shadow: inset 15px -4px 0px 15px #ffcf48;
  }

  .star {
    background-color: #fff;
    border-radius: 50%;
    position: absolute;
    width: 5px;
    transition: all 0.4s;
    height: 5px;
  }

  .star_1 {
    left: 2.5em;
    top: 0.5em;
  }

  .star_2 {
    left: 2.2em;
    top: 1.2em;
  }

  .star_3 {
    left: 3em;
    top: 0.9em;
  }

  .switch input:checked ~ .slider .star {
    opacity: 0;
  }

  .cloud {
    width: 3.5em;
    position: absolute;
    bottom: -1.4em;
    left: -1.1em;
    opacity: 0;
    transition: all 0.4s;
  }

  .switch input:checked ~ .slider .cloud {
    opacity: 1;
  }
</style>