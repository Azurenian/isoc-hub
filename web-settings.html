<div
  id="settings-section"
  class="section"
>
  <!-- Notification Bar -->
  <div
    id="notification-bar"
    style="
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #28a745;
      color: #fff;
      text-align: center;
      padding: 16px 0;
      font-size: 18px;
      z-index: 9999;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    "
  ></div>

  <div class="container" style="max-width: 420px; margin-top: 40px">
    <h1 class="text-center mb-4">⚙️ Settings</h1>
    <h2 class="mb-4">Google Sheet Connection</h2>

    <div class="mb-3">
      <label for="spreadsheet-id-input" class="form-label"
        >Spreadsheet ID</label
      >
      <input
        type="text"
        class="form-control"
        id="spreadsheet-id-input"
        placeholder="Enter Spreadsheet ID"
      />
      <button
        id="search-by-id-btn"
        class="btn btn-primary w-100 mt-2"
        type="button"
      >
        Search by Spreadsheet ID
      </button>
    </div>
    <div class="mb-3">
      <label for="sheet-name-input" class="form-label">Sheet Name</label>
      <input
        type="text"
        class="form-control"
        id="sheet-name-input"
        placeholder="Enter Sheet Name"
      />
      <button
        id="search-by-name-btn"
        class="btn btn-primary w-100 mt-2"
        type="button"
      >
        Search by Sheet Name
      </button>
    </div>
    <div id="sheet-info-status" class="mt-2"></div>

    <!-- Table for displaying fetched data -->
    <div id="sheet-data-container" class="mt-4" style="display:none;">
      <h5>Sheet Data Preview</h5>
      <div class="table-responsive">
        <table id="sheet-data-table" class="table table-bordered table-sm">
          <thead></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
function showNotification(message, color = "#28a745") {
  const bar = document.getElementById("notification-bar");
  bar.textContent = message;
  bar.style.background = color;
  bar.style.display = "block";
  setTimeout(() => bar.classList.add("show"), 10);
  setTimeout(() => {
    bar.classList.remove("show");
    setTimeout(() => {
      bar.style.display = "none";
    }, 400);
  }, 3000);
}

function renderSingleRow(data) {
  const container = document.getElementById("sheet-data-container");
  const table = document.getElementById("sheet-data-table");
  if (!data) {
    container.style.display = "none";
    return;
  }
  // Render header
  const thead = table.querySelector("thead");
  thead.innerHTML = "<tr><th>ID</th><th>Name</th><th>Description</th></tr>";
  // Render body
  const tbody = table.querySelector("tbody");
  tbody.innerHTML = `<tr>
    <td>${data.id}</td>
    <td>${data.name}</td>
    <td>${data.description}</td>
  </tr>`;
  container.style.display = "";
}

function fetchById() {
  const id = document.getElementById("spreadsheet-id-input").value.trim();
  if (!id) {
    showNotification("Please enter a Spreadsheet ID.", "#dc3545");
    return;
  }
  document.getElementById("sheet-info-status").textContent = "Searching...";
  google.script.run
    .withSuccessHandler(function(data) {
      document.getElementById("sheet-info-status").textContent = "";
      renderSingleRow(data);
    })
    .withFailureHandler(function(err) {
      document.getElementById("sheet-info-status").textContent = "Error: " + err.message;
      document.getElementById("sheet-data-container").style.display = "none";
    })
    .findRowBySpreadsheetId(id);
}

function fetchByName() {
  const name = document.getElementById("sheet-name-input").value.trim();
  if (!name) {
    showNotification("Please enter a Sheet Name.", "#dc3545");
    return;
  }
  document.getElementById("sheet-info-status").textContent = "Searching...";
  google.script.run
    .withSuccessHandler(function(data) {
      document.getElementById("sheet-info-status").textContent = "";
      renderSingleRow(data);
    })
    .withFailureHandler(function(err) {
      document.getElementById("sheet-info-status").textContent = "Error: " + err.message;
      document.getElementById("sheet-data-container").style.display = "none";
    })
    .findRowBySheetName(name); // This must match the Apps Script function name
}

document.getElementById("search-by-id-btn").onclick = fetchById;
document.getElementById("search-by-name-btn").onclick = fetchByName;
  </script>
</div>
